[tox]
setenv = PYTHONPATH=./src
envlist =
    isort-check
    black-check
    flake8-check
    pylint-check
    py{36,37,38}
    coverage_report
basepython = python3.8

[testenv]
setenv = PYTHONPATH=./src
deps =
    -rrequirements.txt
    -rrequirements-test.txt
commands = pytest

[testenv:coverage_report]
deps = coverage
commands =
    coverage html
    coverage report --include="src/solarhouse/*" --fail-under=100 -m

[testenv:isort]
changedir = {toxinidir}/src/solarhouse
deps = isort
commands = isort -y -sp={toxinidir}/tox.ini

[testenv:isort-check]
changedir = {toxinidir}/src
deps = isort
commands = isort --check-only -sp={toxinidir}/tox.ini

[isort]
env = PYTHONPATH=./src
multi_line_output=3
include_trailing_comma = True
force_grid_wrap=0
use_parentheses = True
line_length=88

[testenv:black]
deps = black
commands = black src/solarhouse/

[testenv:black-check]
deps = black
commands = black --check src/solarhouse/

[testenv:flake8-check]
deps = flake8
commands = flake8 --config=tox.ini src/solarhouse/

[flake8]
max-line-length=88
ignore=E203,E231,E501

[testenv:pylint-check]
deps =
    {[testenv]deps}
    pylint
commands = pylint --rcfile=tox.ini src/solarhouse/

[MESSAGES CONTROL]
disable=fixme,invalid-name

[testenv:gen_docs]
deps = -r docs/requirements.txt
commands =
    sphinx-build -b html docs/source/ docs/build/

[testenv:build_wheel]
skip_install = True
deps =
    wheel
    docutils
    pygments
commands =
    python3 -c 'import shutil; (shutil.rmtree(p, ignore_errors=True) for p in ["build", "dist"]);'
    python3 setup.py sdist bdist_wheel

[testenv:test_upload]
skip_install = True
deps = twine
commands =
     python3 -m twine upload --repository-url https://test.pypi.org/legacy/ dist/*
